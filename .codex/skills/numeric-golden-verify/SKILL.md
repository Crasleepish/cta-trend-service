---
name: numeric-golden-verify
description: 验证数值计算逻辑正确性
invokable: true
---

# NumericGoldenVerify（数值计算正确性验证）

## 目标
用一套**可复现、可追溯、可固化**的流程，验证代码实现的“计算口径/窗口/缺失处理”是否与文档定义一致，并最终固化为 **golden 单测**。

## 核心约束
- **只看白皮书/设计文档，不看 `src/` 实现** 来推导计算链。
- 源头输入必须来自**真实 DB 拉取**或**此前导出的原始 CSV**（作为唯一原始事实）。
- 每一步计算都要写回 CSV（新增列），保证中间结果可追溯、可复算。
- golden 非必要不改；必要改动必须先确认差异来源（口径/窗口/采样/缺失处理）。

## 步骤
1. 锁定数据源头
明确“计算链条的起点是什么数据”。先不选时间点，先选源头表/字段/时间范围。

2. 导出源头数据
从真实 DB 拉取原始输入数据，导出为一个 CSV（或多份 CSV），作为“唯一原始事实”。

3. 根据文档定义计算链
只看白皮书/设计文档，不看 src/ 代码。写出完整计算链（每一步的输入/输出/公式/窗口/口径）。

4. 逐步手算并写回 CSV 
每算一步就在 CSV 中新增一列，确保中间结果可追溯、可复算。

5. 选典型样本点
原则：有效数字尽可能多地覆盖所有验证目标；必要时选多行。

6. 固化为 golden 单测
用选定样本的结果作为断言值，写入 tests/unit。
该单测只验证“代码输出是否与手算结果一致”。

7. 测试前拉取真实 DB 数据
测试运行前必须从真实 DB 拉取数据（或使用之前导出的 CSV），确保输入与验证口径一致。

8. 运行单测并定位差异
若失败，先排查口径/窗口/采样/缺失处理，再考虑是否更新 golden。
非必要不改 golden，必要改动需先确认。

## 输入
- 相关文档路径&章节
- 验证目标

## 输出
- 数据来源
- 计算链
- CSV 文件路径
- 所选样本
- golden test 路径


